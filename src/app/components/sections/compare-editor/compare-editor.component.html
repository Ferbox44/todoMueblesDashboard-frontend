<div class="compare-editor">
  <p-toast></p-toast>

  <div class="p-fluid">
    <!-- Before Image Upload -->
    <div class="field">
      <label for="beforeImage">Before Image</label>
      <div class="upload-container">
        <div class="upload-section">
          <div class="flex gap-2">
            <p-fileUpload
              mode="basic"
              [auto]="false"
              [showCancelButton]="true"
              [showUploadButton]="false"
              name="beforeImage"
              accept="image/*"
              [maxFileSize]="5000000"
              (onSelect)="onFileSelect($event, 'before')"
              chooseLabel="Choose Image"
              [disabled]="loading || saving">
            </p-fileUpload>
            <button pButton 
              label="Select from Uploaded" 
              icon="pi pi-images" 
              (click)="openImageSelector('before')"
              class="p-button-secondary"
              [disabled]="loading || saving">
            </button>
          </div>

          <div *ngIf="selectedFile" class="upload-actions">
            <p-button
              label="Upload to S3"
              icon="pi pi-upload"
              (onClick)="uploadSelectedFile()"
              [loading]="loading"
              [disabled]="loading || saving"
            ></p-button>
            <p-button
              label="Cancel"
              icon="pi pi-times"
              (onClick)="cancelUpload()"
              [disabled]="loading || saving"
              severity="secondary"
            ></p-button>
          </div>
        </div>
        <div class="preview-container" *ngIf="compareSection.beforeImage">
          <img [src]="compareSection.beforeImage" alt="Before Image" class="preview-image">
          <div class="preview-overlay">
            <span class="preview-label">Current Before Image</span>
          </div>
        </div>
      </div>
    </div>

    <!-- After Image Upload -->
    <div class="field">
      <label for="afterImage">After Image</label>
      <div class="upload-container">
        <div class="upload-section">
          <div class="flex gap-2">
            <p-fileUpload
              mode="basic"
              [auto]="false"
              [showCancelButton]="true"
              [showUploadButton]="false"
              name="afterImage"
              accept="image/*"
              [maxFileSize]="5000000"
              (onSelect)="onFileSelect($event, 'after')"
              chooseLabel="Choose Image"
              [disabled]="loading || saving">
            </p-fileUpload>
            <button pButton 
              label="Select from Uploaded" 
              icon="pi pi-images" 
              (click)="openImageSelector('after')"
              class="p-button-secondary"
              [disabled]="loading || saving">
            </button>
          </div>

          <div *ngIf="selectedFile" class="upload-actions">
            <p-button
              label="Upload to S3"
              icon="pi pi-upload"
              (onClick)="uploadSelectedFile()"
              [loading]="loading"
              [disabled]="loading || saving"
            ></p-button>
            <p-button
              label="Cancel"
              icon="pi pi-times"
              (onClick)="cancelUpload()"
              [disabled]="loading || saving"
              severity="secondary"
            ></p-button>
          </div>
        </div>
        <div class="preview-container" *ngIf="compareSection.afterImage">
          <img [src]="compareSection.afterImage" alt="After Image" class="preview-image">
          <div class="preview-overlay">
            <span class="preview-label">Current After Image</span>
          </div>
        </div>
      </div>
    </div>

    

    <div class="save-section">
      <p-button
        label="Save Section"
        icon="pi pi-save"
        (onClick)="saveChanges()"
        [disabled]="loading || saving"
      ></p-button>
    </div>
  </div>

  <!-- Image Selector Dialog -->
  <p-dialog 
    [(visible)]="showImageSelector" 
    [style]="{width: '80vw'}" 
    [maximizable]="true"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [header]="'Select ' + (currentImageType === 'before' ? 'Before' : 'After') + ' Image'">
    <div class="image-grid">
      <div *ngFor="let image of uploadedImages" 
           class="image-item" 
           (click)="selectImage(image)">
        <p-image 
          [src]="image.url" 
          [preview]="true"
          [alt]="'Uploaded image'"
          width="200"
          height="200"
          styleClass="w-full h-full object-contain">
        </p-image>
      </div>
    </div>
  </p-dialog>
</div> 